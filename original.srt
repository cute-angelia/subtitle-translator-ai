1
00:00:00,366 --> 00:00:01,166
what's going on YouTube

2
00:00:01,166 --> 00:00:03,199
this is I'm doing sauna from hack the box

3
00:00:03,200 --> 00:00:03,966
which is just a

4
00:00:03,966 --> 00:00:06,299
windows box with a web server and active directory

5
00:00:06,300 --> 00:00:07,200
and start on it

6
00:00:07,300 --> 00:00:09,000
we've done plenty of 80 in the past

7
00:00:09,000 --> 00:00:09,966
the videos that come to mine

8
00:00:09,966 --> 00:00:12,399
a real active sizzle and forest

9
00:00:12,500 --> 00:00:14,200
the thing that really sets this one apart

10
00:00:14,200 --> 00:00:15,500
is you can't just use

11
00:00:15,866 --> 00:00:19,899
RPC client or L DAP to dump all the users on the box

12
00:00:19,966 --> 00:00:20,899
instead we can kind of

13
00:00:20,900 --> 00:00:23,566
do a boolean logic to check if a user exist

14
00:00:23,566 --> 00:00:25,599
through kirbros pre authentication

15
00:00:25,933 --> 00:00:28,399
essentially you give it a username if

16
00:00:28,700 --> 00:00:30,066
kirbros responds with

17
00:00:30,100 --> 00:00:31,300
pre authentication required

18
00:00:31,300 --> 00:00:33,266
you know that user exist on the box

19
00:00:33,366 --> 00:00:35,466
so we're going to go through the website of the box

20
00:00:35,466 --> 00:00:37,733
pull a bunch of names off the site

21
00:00:37,966 --> 00:00:39,133
and then use a bit of them

22
00:00:39,133 --> 00:00:41,799
magic to convert those names into possible usernames

23
00:00:41,866 --> 00:00:44,299
pass it into a tool called curb route

24
00:00:44,400 --> 00:00:46,200
to find some valid usernames

25
00:00:46,266 --> 00:00:47,533
and then with those usernames

26
00:00:47,533 --> 00:00:49,799
pass it to some impacket scripts to do some as

27
00:00:49,966 --> 00:00:52,066
rep roasting to get a

28
00:00:52,666 --> 00:00:54,966
password hash of an account pass it to hashcat

29
00:00:54,966 --> 00:00:56,699
crack it log into the box

30
00:00:56,800 --> 00:00:58,600
and then once you log into the box

31
00:00:58,900 --> 00:01:00,933
privasking is simply running

32
00:01:01,300 --> 00:01:02,900
blood hound and wind peas

33
00:01:02,933 --> 00:01:05,866
combining the 2 outputs and you can DC sync

34
00:01:05,933 --> 00:01:08,333
so it probably sounds a lot more complicated than it is

35
00:01:08,400 --> 00:01:09,800
so let's just jump in

36
00:01:10,133 --> 00:01:11,266
as always we want to start over

37
00:01:11,266 --> 00:01:13,333
the n map so dash s C for default scripts

38
00:01:13,333 --> 00:01:15,966
s V enumerate versions O a I'll put all formats

39
00:01:15,966 --> 00:01:18,933
print the n map directory and we have to create it

40
00:01:20,700 --> 00:01:22,100
create the n map directory

41
00:01:22,100 --> 00:01:24,066
and then we can call it sauna

42
00:01:24,300 --> 00:01:26,300
1010 175

43
00:01:27,266 --> 00:01:29,299
always want to run and map with pseudo

44
00:01:29,300 --> 00:01:30,933
and then I'm gonna add a dash V flag

45
00:01:30,933 --> 00:01:33,166
so we can see open ports as it finds it

46
00:01:33,400 --> 00:01:36,500
we see 80 is open which is going to be a web server

47
00:01:36,500 --> 00:01:43,100
53 DNS a bunch of um like SMB RPC ports

48
00:01:43,300 --> 00:01:46,000
I don't know exactly what 3268 is

49
00:01:46,766 --> 00:01:49,099
um don't know what five ninety three

50
00:01:49,100 --> 00:01:51,600
I think 06:36 is encrypted L DAP

51
00:01:52,333 --> 00:01:54,099
we see kerbros down here

52
00:01:54,100 --> 00:01:57,933
so based upon saying 4 45 which is SMB

53
00:01:58,300 --> 00:02:00,133
so we know there's a windows box

54
00:02:00,366 --> 00:02:03,733
53 DNS and 88 kurbrose

55
00:02:03,766 --> 00:02:07,133
I'm guessing this is a windows domain controller

56
00:02:07,133 --> 00:02:09,133
so the very 1st thing I want to do is probably

57
00:02:09,133 --> 00:02:10,733
enumerate 4 or 4 or 5

58
00:02:10,733 --> 00:02:13,099
and then we'll move on to port 80

59
00:02:13,600 --> 00:02:14,866
so let's do

60
00:02:15,800 --> 00:02:19,733
crack map exec SMB 1010

61
00:02:19,866 --> 00:02:21,766
175 to see

62
00:02:22,066 --> 00:02:23,133
everything about this

63
00:02:23,866 --> 00:02:26,866
hurst we see the hurst name is going to be sana

64
00:02:26,866 --> 00:02:29,766
the domain name is egotistical dashbank dot local

65
00:02:31,000 --> 00:02:34,866
signing is set to true and smbv1 is disabled

66
00:02:35,200 --> 00:02:35,966
so

67
00:02:35,966 --> 00:02:39,466
let's do shares to see if we can enumerate any shares

68
00:02:40,900 --> 00:02:43,866
and we get a status use a chess and delete in

69
00:02:43,866 --> 00:02:46,299
we can try a blank username password

70
00:02:46,600 --> 00:02:48,400
to see if this gets around that

71
00:02:48,766 --> 00:02:50,666
sometimes it does sometimes it doesn't

72
00:02:50,866 --> 00:02:54,499
and we see access denied so we can't

73
00:02:55,266 --> 00:02:57,966
we could try other tools like SMB map

74
00:02:58,000 --> 00:03:02,666
I think it's dash I 10 1010 one 75 dash U dash

75
00:03:03,533 --> 00:03:04,333
P

76
00:03:05,600 --> 00:03:06,400
dash H

77
00:03:08,900 --> 00:03:09,300
run

78
00:03:09,300 --> 00:03:11,966
this and we don't really get anything

79
00:03:12,266 --> 00:03:13,066
so

80
00:03:13,600 --> 00:03:15,600
good go and try a bunch of SMB tools

81
00:03:15,600 --> 00:03:18,400
but if crack map exact and SMB map don't get anything

82
00:03:18,733 --> 00:03:19,733
gently move on

83
00:03:20,200 --> 00:03:24,733
we can try RPC client 10 1010 one semi 5

84
00:03:26,200 --> 00:03:27,566
and we can't connect

85
00:03:27,666 --> 00:03:30,266
let's just do a blank user

86
00:03:30,266 --> 00:03:31,733
it's dash capital W

87
00:03:34,200 --> 00:03:36,900
and then I think it's enume dumb users

88
00:03:36,900 --> 00:03:38,933
to see if you can get a username dump

89
00:03:39,066 --> 00:03:41,733
we get access denied so

90
00:03:42,066 --> 00:03:44,766
can't really do anything with this

91
00:03:46,400 --> 00:03:48,800
the one thing I want to do is

92
00:03:49,900 --> 00:03:51,066
start creating notes

93
00:03:51,400 --> 00:03:54,300
so let's do control n to create a new node

94
00:03:54,300 --> 00:03:55,766
call it sauna

95
00:03:56,000 --> 00:03:58,000
control shift n for a child node

96
00:03:58,200 --> 00:03:59,366
call it notes

97
00:03:59,766 --> 00:04:01,333
and then I'm going to

98
00:04:01,333 --> 00:04:05,299
copy the domain egotistical dashbank dot local

99
00:04:06,766 --> 00:04:08,733
and we'll paste that in here

100
00:04:09,266 --> 00:04:11,266
and we can go check out the web server

101
00:04:11,266 --> 00:04:14,366
10 1010 dot one 75

102
00:04:19,366 --> 00:04:21,299
so it looks like a

103
00:04:22,166 --> 00:04:24,666
standard page I'm gonna press ctrl you

104
00:04:24,966 --> 00:04:27,066
and we're gonna see if we can identify what

105
00:04:27,566 --> 00:04:29,466
like CMS or how this is built

106
00:04:30,466 --> 00:04:32,533
if we saw like word press or triple stuff

107
00:04:32,533 --> 00:04:34,099
we note are on those type of scanners

108
00:04:34,100 --> 00:04:35,300
but I don't really

109
00:04:36,600 --> 00:04:38,066
see any of that

110
00:04:38,900 --> 00:04:40,400
the next thing we could probably do

111
00:04:40,600 --> 00:04:42,266
is try to guess the extension

112
00:04:42,266 --> 00:04:44,266
so probably index dot HTML

113
00:04:44,366 --> 00:04:46,899
we got that we could try PHP

114
00:04:47,566 --> 00:04:48,399
not found

115
00:04:48,400 --> 00:04:49,600
ASP

116
00:04:50,700 --> 00:04:54,800
aspx so it looks like it's HTML files

117
00:04:58,366 --> 00:05:00,599
if we did have this in burp suite

118
00:05:00,600 --> 00:05:03,333
we could probably just have burp crawlette and then

119
00:05:03,366 --> 00:05:04,966
identify files that way

120
00:05:04,966 --> 00:05:06,399
so let's turn intercept off

121
00:05:06,866 --> 00:05:08,266
refresh the page

122
00:05:09,266 --> 00:05:10,899
go over to a target

123
00:05:12,133 --> 00:05:14,566
and then we could just look at files this way

124
00:05:14,566 --> 00:05:15,799
and could also

125
00:05:16,733 --> 00:05:18,166
maybe passively scan

126
00:05:20,366 --> 00:05:21,666
ah scan

127
00:05:22,966 --> 00:05:24,699
it's been so long since I used the new version of

128
00:05:24,700 --> 00:05:26,366
Brooks we don't even know how to launch a crawl

129
00:05:26,366 --> 00:05:27,166
but

130
00:05:28,400 --> 00:05:30,966
go through and see if we see any um

131
00:05:31,966 --> 00:05:34,566
extensions but everything is just HTML

132
00:05:35,500 --> 00:05:36,300
so

133
00:05:37,600 --> 00:05:40,866
click on the pages see if we have anything unique

134
00:05:41,800 --> 00:05:44,700
just looking for ways we can interact with this

135
00:05:44,766 --> 00:05:46,599
so there is this newsletter here

136
00:05:46,600 --> 00:05:48,666
so we can put our email address

137
00:05:48,966 --> 00:05:52,199
so do like oh my god is that

138
00:05:54,400 --> 00:05:57,166
so the color is white on white for some reason

139
00:05:57,366 --> 00:05:58,566
so we're just gonna put

140
00:05:59,466 --> 00:06:03,099
please subscribe at ipsec dot rocks

141
00:06:03,333 --> 00:06:04,999
highlight so you can see it

142
00:06:05,966 --> 00:06:08,099
click subscribe and

143
00:06:09,133 --> 00:06:11,533
http verb used to

144
00:06:12,000 --> 00:06:12,966
not allowed

145
00:06:13,466 --> 00:06:15,899
so let's go to proxy intercept

146
00:06:15,900 --> 00:06:17,866
I'm guessing this was a post request

147
00:06:18,466 --> 00:06:20,333
and maybe post just isn't allowed

148
00:06:21,700 --> 00:06:24,466
so send we get method not allowed

149
00:06:24,800 --> 00:06:28,700
this is verb it's like get post head

150
00:06:29,533 --> 00:06:32,599
options there's a few of those verbs

151
00:06:32,600 --> 00:06:35,800
so let's change the request method to a get request

152
00:06:37,933 --> 00:06:39,899
and doesn't look like anything happened

153
00:06:39,933 --> 00:06:43,999
so I'm looking at the paid bytes at the bottom so 31223

154
00:06:45,133 --> 00:06:46,733
just being sure that doesn't change

155
00:06:46,733 --> 00:06:48,766
and let's get rid of this email

156
00:06:49,866 --> 00:06:53,766
so 3 1 2 2 33 1 2 23

157
00:06:54,000 --> 00:06:56,100
so I don't have to read this whole thing

158
00:06:56,100 --> 00:06:58,133
I can guess the page is probably the same

159
00:06:58,366 --> 00:07:00,899
so doing that just did nothing

160
00:07:00,900 --> 00:07:02,866
so we can just move on from that

161
00:07:06,366 --> 00:07:07,166
let's see

162
00:07:08,066 --> 00:07:09,166
let's go all the way up

163
00:07:09,166 --> 00:07:11,299
click around blogs

164
00:07:11,366 --> 00:07:12,799
blogs could have something useful

165
00:07:15,500 --> 00:07:16,400
single

166
00:07:16,733 --> 00:07:17,899
HTML

167
00:07:18,800 --> 00:07:20,400
are these all the same

168
00:07:21,166 --> 00:07:21,999
yes it is

169
00:07:22,100 --> 00:07:24,466
so this is definitely some type of static website

170
00:07:24,700 --> 00:07:25,533
so

171
00:07:26,300 --> 00:07:27,866
this looks like different post

172
00:07:27,933 --> 00:07:30,599
clicking on these post we go to the same

173
00:07:30,666 --> 00:07:32,299
single dot PHP page

174
00:07:32,700 --> 00:07:35,333
so at this point I'm assuming this is just a

175
00:07:35,466 --> 00:07:38,266
static page and we have to just

176
00:07:38,300 --> 00:07:40,566
get some type of valuable information off this

177
00:07:40,566 --> 00:07:41,899
we could run cool

178
00:07:42,000 --> 00:07:42,700
which is like

179
00:07:42,700 --> 00:07:45,333
going to gather a wordless based upon the web page

180
00:07:47,066 --> 00:07:49,166
I bet if we just do anything here

181
00:07:49,600 --> 00:07:52,266
it's going to go to invalid verb

182
00:07:55,733 --> 00:07:58,899
invalid verb so nothing there so

183
00:08:00,166 --> 00:08:00,999
could run cool

184
00:08:01,000 --> 00:08:02,666
and grab information off this

185
00:08:02,666 --> 00:08:04,266
but if we had a password list

186
00:08:04,266 --> 00:08:05,499
we don't really know

187
00:08:06,566 --> 00:08:07,666
an account yet

188
00:08:08,000 --> 00:08:08,866
so

189
00:08:09,533 --> 00:08:13,099
let's see if we can find usernames on a page

190
00:08:14,000 --> 00:08:16,300
so maybe the about us page

191
00:08:18,733 --> 00:08:20,333
and we have

192
00:08:21,600 --> 00:08:22,666
users

193
00:08:23,600 --> 00:08:25,900
so let's copy this

194
00:08:26,900 --> 00:08:28,300
curve with a Cherry Tree

195
00:08:29,300 --> 00:08:31,500
control shift and users

196
00:08:32,766 --> 00:08:34,666
paste doesn't want to paste

197
00:08:35,100 --> 00:08:38,733
so let's windows key L to put down the left oh god

198
00:08:38,900 --> 00:08:40,533
it pasted all the images and everything

199
00:08:41,600 --> 00:08:43,300
but windows key

200
00:08:43,466 --> 00:08:43,766
out

201
00:08:43,766 --> 00:08:45,466
left they put it on the left

202
00:08:45,466 --> 00:08:48,166
I did windows key right here to put it on the right

203
00:08:48,500 --> 00:08:51,400
and it'll just make it quicker to copy and paste

204
00:08:51,400 --> 00:08:53,700
so let's just copy the use names

205
00:08:54,533 --> 00:08:55,366
this way

206
00:08:56,400 --> 00:08:57,200
oh god

207
00:08:57,866 --> 00:08:59,999
control a delete paste

208
00:09:01,266 --> 00:09:02,933
copy paste

209
00:09:03,766 --> 00:09:06,966
copy paste copy paste

210
00:09:11,166 --> 00:09:14,133
so now we have a list of potential users

211
00:09:14,300 --> 00:09:16,400
we have to convert this into

212
00:09:17,133 --> 00:09:21,333
use name formats that windows generally uses so

213
00:09:23,133 --> 00:09:23,933
let's

214
00:09:25,000 --> 00:09:27,366
do this user text

215
00:09:28,100 --> 00:09:31,000
and we could also try searching L DAP

216
00:09:32,133 --> 00:09:34,566
because actor directory does expose LD app

217
00:09:34,566 --> 00:09:35,899
so we can do LD app search

218
00:09:35,900 --> 00:09:39,600
dash X dash H 1010 10 one 75

219
00:09:41,000 --> 00:09:42,466
we have to get the

220
00:09:43,100 --> 00:09:47,000
naming context or dash s base naming context

221
00:09:49,200 --> 00:09:51,333
and we want this string

222
00:09:55,333 --> 00:09:57,499
we can do dashby

223
00:10:00,466 --> 00:10:03,699
and query elder manually and if we're lucky

224
00:10:04,000 --> 00:10:06,366
we could potentially get usernames

225
00:10:06,766 --> 00:10:08,366
but it looks like we don't have

226
00:10:09,100 --> 00:10:10,100
that permission

227
00:10:10,266 --> 00:10:14,066
if we had if I was allowed for anonymous elda

228
00:10:14,666 --> 00:10:16,999
down here you'd see a bunch more information

229
00:10:17,366 --> 00:10:21,499
for like huger smith which is a user I believe

230
00:10:26,066 --> 00:10:28,533
we'd see something like this right here

231
00:10:30,200 --> 00:10:31,566
what is this

232
00:10:31,566 --> 00:10:33,099
this is

233
00:10:33,366 --> 00:10:34,166
DN

234
00:10:37,766 --> 00:10:40,166
let's just grip dash I for sam

235
00:10:41,000 --> 00:10:42,400
because the username

236
00:10:42,400 --> 00:10:44,666
and actor directory is like a sam account name

237
00:10:44,700 --> 00:10:46,066
but we don't get that so

238
00:10:46,266 --> 00:10:48,299
this doesn't really tell us the username format

239
00:10:48,300 --> 00:10:49,900
how odaps not giving us anything

240
00:10:49,900 --> 00:10:53,733
so going back to that users dot text file

241
00:10:53,966 --> 00:10:56,866
we could create a python script to transform this

242
00:10:56,966 --> 00:10:59,199
into a bunch of potential usernames

243
00:10:59,333 --> 00:11:00,399
but whenever you do

244
00:11:00,400 --> 00:11:02,166
like a CTF for you under a time constraint

245
00:11:02,166 --> 00:11:03,733
you don't always want to read a script

246
00:11:03,766 --> 00:11:05,966
and sometimes it's handy just to know how to

247
00:11:05,966 --> 00:11:07,266
use the tools you have

248
00:11:07,400 --> 00:11:10,166
so I'm going to use a vim macro

249
00:11:10,733 --> 00:11:13,799
so we're going to start the macro off by doing Q a

250
00:11:13,800 --> 00:11:16,266
and that means record this macro

251
00:11:16,266 --> 00:11:17,733
and is going to be on a

252
00:11:18,333 --> 00:11:20,866
so I'm going to start this macro off with y

253
00:11:20,866 --> 00:11:22,299
y to yank the line

254
00:11:22,466 --> 00:11:25,899
and I want to change this into probably 3 other things

255
00:11:25,900 --> 00:11:26,766
so I'm going to do a 3

256
00:11:27,000 --> 00:11:30,100
p to put the line I just yanked

257
00:11:30,400 --> 00:11:33,500
3 times so we can see fergusmith is now

258
00:11:33,766 --> 00:11:34,566
got 4

259
00:11:34,933 --> 00:11:36,899
I'm gonna hit home just to my cursors

260
00:11:36,900 --> 00:11:38,133
always gonna be at the beginning

261
00:11:38,133 --> 00:11:39,533
slash space

262
00:11:40,166 --> 00:11:42,799
then s period escape

263
00:11:43,266 --> 00:11:46,799
so that fix that one spot and go hit the down arrow

264
00:11:47,133 --> 00:11:48,266
home key again

265
00:11:48,800 --> 00:11:51,533
write one DW for delete word

266
00:11:51,766 --> 00:11:54,099
go down one hit the home key

267
00:11:54,500 --> 00:12:00,200
right one DWI for insert period to put a dot there

268
00:12:00,366 --> 00:12:02,166
hit the down key hit the home

269
00:12:02,400 --> 00:12:05,100
escape to exit insert mode

270
00:12:05,366 --> 00:12:06,366
and

271
00:12:07,266 --> 00:12:09,266
Q to exit recording mode

272
00:12:09,266 --> 00:12:11,199
so now when I do at a

273
00:12:11,466 --> 00:12:13,866
it replays all those keys I just did to them

274
00:12:14,200 --> 00:12:15,333
and then we have

275
00:12:16,466 --> 00:12:20,733
4 more lines so I can do 4 at a to repeat it 4 times

276
00:12:20,766 --> 00:12:21,966
and now we have a

277
00:12:21,966 --> 00:12:24,566
really nice user list of everything we saw

278
00:12:25,700 --> 00:12:27,666
so w Q to exit

279
00:12:28,066 --> 00:12:31,299
and I'm going to go grab a tool curd called

280
00:12:31,800 --> 00:12:35,133
curb route which 0 xdf pointed out to me

281
00:12:35,466 --> 00:12:38,699
because this does a kubros pre authentication attack

282
00:12:38,700 --> 00:12:40,400
against it 80

283
00:12:40,733 --> 00:12:43,399
and this can help us identify valid users

284
00:12:43,666 --> 00:12:45,366
so essentially

285
00:12:47,200 --> 00:12:48,733
when you attempt to authenticate

286
00:12:48,766 --> 00:12:51,199
to an ad server via cubros

287
00:12:51,300 --> 00:12:53,866
if you have a valid username it's going to say hey

288
00:12:54,266 --> 00:12:56,499
please continue with pre authentication

289
00:12:56,566 --> 00:12:59,366
if you don't have a valid username it doesn't do that

290
00:12:59,600 --> 00:13:02,533
and that's how this attack essentially works

291
00:13:02,600 --> 00:13:05,300
and then you can also do um

292
00:13:06,300 --> 00:13:07,933
root forcing passwords with this

293
00:13:08,166 --> 00:13:09,499
and the cool thing about it

294
00:13:09,500 --> 00:13:11,966
it's not going to create event code 46 24

295
00:13:12,333 --> 00:13:14,266
it's going to create a curbrose failure

296
00:13:14,800 --> 00:13:17,133
thing which by default is not logged

297
00:13:17,300 --> 00:13:20,300
so it's a good way to brute force accounts with

298
00:13:20,500 --> 00:13:22,500
potentially just not being seen

299
00:13:22,900 --> 00:13:24,766
it does increase the

300
00:13:25,366 --> 00:13:27,399
failed login if they have that locked out

301
00:13:27,400 --> 00:13:29,333
you can lock counts without with this

302
00:13:29,333 --> 00:13:32,199
it's not a bypass to that it's just a way to

303
00:13:32,500 --> 00:13:34,466
do a password spray without cleaning that

304
00:13:34,466 --> 00:13:35,966
event code 46 24

305
00:13:36,566 --> 00:13:38,466
but we're not gonna do a password spray with it

306
00:13:38,466 --> 00:13:41,099
we're going to um

307
00:13:42,300 --> 00:13:43,500
use it to

308
00:13:45,333 --> 00:13:46,933
enumerate valid usernames

309
00:13:47,200 --> 00:13:48,566
so I'm just going to download it

310
00:13:48,566 --> 00:13:48,999
you could

311
00:13:49,000 --> 00:13:51,133
clone it and build it yourself if you wanted to

312
00:13:51,533 --> 00:13:53,199
and I'm going to copy that

313
00:13:55,533 --> 00:13:56,966
into my directory

314
00:13:58,000 --> 00:13:59,466
ch mod plus x

315
00:13:59,966 --> 00:14:01,333
and I'm just going to

316
00:14:01,333 --> 00:14:03,066
rename it because I don't want that

317
00:14:03,066 --> 00:14:04,333
Linux MD 64

318
00:14:05,466 --> 00:14:08,166
but when we execute it we can see all the modes

319
00:14:08,733 --> 00:14:11,566
what you want to do user innume

320
00:14:12,600 --> 00:14:14,200
so we do user anom

321
00:14:14,200 --> 00:14:15,000
h

322
00:14:15,800 --> 00:14:17,700
and see the flags

323
00:14:18,400 --> 00:14:21,533
so use a name word list is gonna be users dot text

324
00:14:21,733 --> 00:14:23,799
but before you give it the word list

325
00:14:23,800 --> 00:14:25,866
we have to tell it where the domain controller is

326
00:14:25,866 --> 00:14:27,466
so dash dash d C

327
00:14:28,100 --> 00:14:31,400
1010 175 dash d which is the domain

328
00:14:31,766 --> 00:14:34,599
egotisticalbank dot local

329
00:14:35,300 --> 00:14:38,066
and then now we can do user text

330
00:14:38,166 --> 00:14:41,566
and we don't find a single one

331
00:14:41,866 --> 00:14:46,133
so let's go into user text and let's create something

332
00:14:46,400 --> 00:14:47,900
that we know exist

333
00:14:48,200 --> 00:14:50,666
like an user called administrator

334
00:14:50,733 --> 00:14:52,099
we could also do guest

335
00:14:52,933 --> 00:14:56,133
because these are default windows accounts

336
00:14:56,300 --> 00:14:59,000
so we should get always get hits with these accounts

337
00:14:59,000 --> 00:15:00,000
so we can see

338
00:15:00,166 --> 00:15:01,899
our curb route script does work

339
00:15:01,900 --> 00:15:03,966
because we validate administrator

340
00:15:03,966 --> 00:15:06,266
egotisticalbank dot local exist

341
00:15:06,533 --> 00:15:07,733
so let's see if we want to do

342
00:15:07,733 --> 00:15:09,799
any more permutations on the name

343
00:15:10,300 --> 00:15:13,100
and right now I'm noticing that

344
00:15:13,266 --> 00:15:16,399
there's a space at the end of every line

345
00:15:16,600 --> 00:15:18,666
the dollar sign just means end of line

346
00:15:18,666 --> 00:15:20,899
the space means well it's a space

347
00:15:21,166 --> 00:15:25,599
so let's do colon percent s space dollar sign

348
00:15:25,900 --> 00:15:28,600
and that's gonna search for anything that has a space

349
00:15:28,600 --> 00:15:29,966
and then end of line

350
00:15:31,000 --> 00:15:31,866
do another slash

351
00:15:31,866 --> 00:15:34,533
so replace it with nothing and G to make it global

352
00:15:34,800 --> 00:15:38,266
so now we removed the trailing space from all the lines

353
00:15:38,466 --> 00:15:40,466
let's go and run this again

354
00:15:40,866 --> 00:15:44,533
and we get 2 valid users administrator and F smith

355
00:15:44,533 --> 00:15:47,133
so let's go to users

356
00:15:47,533 --> 00:15:48,966
and we can say

357
00:15:49,400 --> 00:15:50,666
administrator

358
00:15:51,966 --> 00:15:55,299
F smith so we know those 2 are valid

359
00:15:55,766 --> 00:15:57,699
and at this point I'm gonna check

360
00:15:57,933 --> 00:16:00,699
the impacket scripts what we can do with usernames

361
00:16:00,900 --> 00:16:02,766
and to find my location of impacket

362
00:16:02,766 --> 00:16:05,366
I always just do locate PS xx.py

363
00:16:05,366 --> 00:16:08,866
because I never can remember this example directory

364
00:16:09,933 --> 00:16:10,733
but

365
00:16:11,400 --> 00:16:14,200
I highly recommend if you don't know all these scripts

366
00:16:14,333 --> 00:16:15,733
go through each of them

367
00:16:15,966 --> 00:16:19,566
and just like add exact H less

368
00:16:19,933 --> 00:16:20,899
and read the

369
00:16:20,900 --> 00:16:24,133
description to find out exactly what they do

370
00:16:24,533 --> 00:16:27,799
because there's 2 scripts that are super valuable

371
00:16:29,266 --> 00:16:31,666
let's get NP user

372
00:16:32,500 --> 00:16:34,733
which is going to be the

373
00:16:36,066 --> 00:16:39,299
as rep roast or some people call it curb roasting

374
00:16:39,300 --> 00:16:40,900
but this is the as rep one

375
00:16:41,133 --> 00:16:42,999
and it queries the target to main

376
00:16:43,000 --> 00:16:44,766
for users that do not require

377
00:16:44,766 --> 00:16:46,533
curb roast pre authentication set

378
00:16:46,666 --> 00:16:47,466
and it can

379
00:16:47,866 --> 00:16:50,699
export their ticket granting ticket for cracking

380
00:16:51,400 --> 00:16:54,900
and another good one is get user SPN

381
00:16:54,900 --> 00:16:57,266
I think this one set if it's um

382
00:16:57,733 --> 00:16:59,333
store pass when reversible format

383
00:16:59,333 --> 00:17:01,099
I'm not exactly sure what that one is

384
00:17:01,333 --> 00:17:03,599
but definitely take a look at all the impact scripts

385
00:17:03,600 --> 00:17:05,866
there's definitely really good ones there

386
00:17:06,266 --> 00:17:08,933
but this is the one we want to use probably

387
00:17:09,733 --> 00:17:11,133
so let's do

388
00:17:13,566 --> 00:17:16,466
target so this will be egotistical

389
00:17:17,000 --> 00:17:18,733
bank dot local

390
00:17:18,766 --> 00:17:19,866
slash

391
00:17:20,333 --> 00:17:24,299
administrator and the next one we'll do is F smith

392
00:17:28,200 --> 00:17:30,600
and let's see do we get anything

393
00:17:32,066 --> 00:17:35,066
it's taking a while so I'm just going to do 2

394
00:17:35,566 --> 00:17:40,199
egotistical bank dot local F smith

395
00:17:44,133 --> 00:17:47,166
and it doesn't look like it's working oh

396
00:17:47,466 --> 00:17:48,533
we probably should

397
00:17:49,000 --> 00:17:50,100
at this point

398
00:17:50,900 --> 00:17:52,933
add the domain to our DNS

399
00:17:53,566 --> 00:17:56,399
so pseudovi Etsy host

400
00:17:57,300 --> 00:18:00,966
10 1010 one 75 egotistical bank

401
00:18:01,333 --> 00:18:05,899
we can call it also sana and sana dot egotistical bank

402
00:18:10,933 --> 00:18:13,799
so now we say we cannot authenticate to administrator

403
00:18:13,800 --> 00:18:18,933
can't do TGT user administrator doesn't have that set

404
00:18:19,333 --> 00:18:21,099
so now let's try

405
00:18:21,966 --> 00:18:22,999
F smith

406
00:18:26,100 --> 00:18:26,966
and

407
00:18:28,166 --> 00:18:30,366
we can get the

408
00:18:33,300 --> 00:18:34,100
TGT

409
00:18:34,166 --> 00:18:35,399
and we can crack this

410
00:18:35,400 --> 00:18:36,300
because the

411
00:18:36,300 --> 00:18:38,966
encryption key or signing key for this is going to be

412
00:18:39,166 --> 00:18:40,466
the user's password

413
00:18:40,900 --> 00:18:43,666
so let's go over to a crack and machine

414
00:18:45,533 --> 00:18:48,066
and you can just use hashcat on your desktop

415
00:18:48,066 --> 00:18:50,166
I wouldn't recommend using hashcat in a VM ever

416
00:18:50,166 --> 00:18:51,133
just because

417
00:18:51,600 --> 00:18:54,800
cracking is generally a CPU a GPU intensive process

418
00:18:55,000 --> 00:18:58,900
so doing it in a VM where you are constrained

419
00:18:59,166 --> 00:19:00,599
generally doesn't work out well

420
00:19:01,066 --> 00:19:01,966
so VI

421
00:19:02,866 --> 00:19:05,933
let's do hashes slash sauna

422
00:19:06,733 --> 00:19:10,566
paste that and we can do dot slash hash cat

423
00:19:11,800 --> 00:19:14,500
dash dash example hashes

424
00:19:15,100 --> 00:19:16,200
grep for

425
00:19:16,900 --> 00:19:19,300
what was it caroby

426
00:19:19,533 --> 00:19:22,933
or just grep for as rep and look for 23

427
00:19:24,100 --> 00:19:25,300
as rep

428
00:19:26,100 --> 00:19:28,300
so we have it here it's only one format

429
00:19:28,566 --> 00:19:31,666
so I can do less as rap

430
00:19:32,400 --> 00:19:33,100
let me see

431
00:19:33,100 --> 00:19:33,933
mode

432
00:19:34,000 --> 00:19:35,366
18 200

433
00:19:36,600 --> 00:19:40,900
so let's do dot slash hash cat dash m 18200

434
00:19:41,733 --> 00:19:44,166
and the word list which is going

435
00:19:44,500 --> 00:19:47,100
the hashbile which is going to be hashes sauna

436
00:19:47,566 --> 00:19:49,499
and then the word list we want to use 1st

437
00:19:49,500 --> 00:19:52,300
I always use opt word list rock u dot text

438
00:19:53,300 --> 00:19:55,766
and we'll see if we get any hits

439
00:19:56,666 --> 00:19:58,066
we got one crack

440
00:20:00,533 --> 00:20:03,966
looking at it the password is the strokes 23

441
00:20:05,000 --> 00:20:08,200
so let's go here cruds

442
00:20:09,200 --> 00:20:10,966
where was it F smith

443
00:20:11,166 --> 00:20:12,333
the strokes 23

444
00:20:13,533 --> 00:20:16,399
so now let's see what we can use with this

445
00:20:16,400 --> 00:20:17,300
so I'm going to do

446
00:20:17,666 --> 00:20:19,699
crack map exact SMB

447
00:20:20,400 --> 00:20:22,133
10 1010 once MB5

448
00:20:22,533 --> 00:20:25,466
U f smith dash P

449
00:20:25,766 --> 00:20:27,466
the strokes 23

450
00:20:29,666 --> 00:20:31,533
and we can see

451
00:20:31,800 --> 00:20:32,900
it is valid

452
00:20:32,900 --> 00:20:35,866
but it doesn't have pone to it so we can't just

453
00:20:40,266 --> 00:20:41,533
PS exec into it

454
00:20:41,766 --> 00:20:43,166
I'm gonna do dash dash shares

455
00:20:43,166 --> 00:20:44,499
to see if there's any shares

456
00:20:44,500 --> 00:20:46,066
we want to go enumerate

457
00:20:46,700 --> 00:20:49,600
this should tell us if we have right access to anything

458
00:20:49,600 --> 00:20:51,266
and just list them in general

459
00:20:52,500 --> 00:20:53,166
and I guess

460
00:20:53,166 --> 00:20:53,566
okay

461
00:20:53,566 --> 00:20:55,933
I was gonna say that's looks like it's taking a while

462
00:20:56,100 --> 00:20:56,900
um

463
00:20:57,200 --> 00:20:59,333
we do have a printer

464
00:20:59,566 --> 00:21:01,133
that's funny we can print money

465
00:21:01,366 --> 00:21:03,066
oh we can't print money

466
00:21:03,800 --> 00:21:04,600
but

467
00:21:06,466 --> 00:21:07,266
ah

468
00:21:08,400 --> 00:21:09,766
can copy this

469
00:21:10,800 --> 00:21:11,700
notes

470
00:21:13,400 --> 00:21:14,366
paste that

471
00:21:19,200 --> 00:21:20,133
switch point

472
00:21:22,066 --> 00:21:22,866
Rico

473
00:21:24,300 --> 00:21:25,966
some reason remember being

474
00:21:25,966 --> 00:21:28,966
yeah a local privasque with this

475
00:21:29,466 --> 00:21:30,366
where does the state

476
00:21:32,733 --> 00:21:34,766
such point dash X

477
00:21:37,000 --> 00:21:39,133
2019

478
00:21:40,900 --> 00:21:42,666
let's go back to this page

479
00:21:45,866 --> 00:21:47,966
let's do a W get on this image

480
00:21:50,966 --> 00:21:52,199
exhibit tool

481
00:21:53,366 --> 00:21:55,866
on about that HTML

482
00:21:58,333 --> 00:22:01,366
so about that HTML was created February 10th

483
00:22:01,400 --> 00:22:03,666
which is probably around the time this box was created

484
00:22:04,000 --> 00:22:09,566
and the Rico privasque we saw was a 2019 CBE

485
00:22:09,933 --> 00:22:11,366
so I'm just going to

486
00:22:14,400 --> 00:22:16,866
local privasque put a note for that

487
00:22:17,933 --> 00:22:19,999
because that is definitely interesting

488
00:22:22,566 --> 00:22:25,566
but we still don't have a way to get shell in the box

489
00:22:26,500 --> 00:22:29,100
so let's go and try

490
00:22:30,766 --> 00:22:31,699
win RM

491
00:22:34,100 --> 00:22:35,166
for windows are moot

492
00:22:35,533 --> 00:22:38,533
and this will tell us if we can get on the box

493
00:22:40,966 --> 00:22:41,966
come on

494
00:22:42,866 --> 00:22:44,566
sometimes it takes a water run

495
00:22:45,666 --> 00:22:46,699
let's see

496
00:22:52,066 --> 00:22:55,666
and it shows that we can indeed get on the box

497
00:22:56,066 --> 00:23:00,099
so evil win RM I think we give it dash I for IP

498
00:23:00,100 --> 00:23:03,666
10 1010 one semi 5 dash U for user F smith

499
00:23:04,133 --> 00:23:08,299
beef password the strokes 23

500
00:23:13,066 --> 00:23:13,866
and

501
00:23:13,900 --> 00:23:14,866
here we are

502
00:23:15,200 --> 00:23:18,533
so let's go and run win peas

503
00:23:19,166 --> 00:23:21,999
so let's go LS opt

504
00:23:24,000 --> 00:23:28,933
privilege escalation script awesome sweet win peas

505
00:23:30,133 --> 00:23:31,666
when p's exe

506
00:23:34,666 --> 00:23:36,866
it's under think windpiece again

507
00:23:39,066 --> 00:23:39,866
bin

508
00:23:40,600 --> 00:23:41,700
release

509
00:23:42,766 --> 00:23:43,999
win pzxi

510
00:23:45,900 --> 00:23:46,800
let's just

511
00:23:47,566 --> 00:23:48,566
copy that

512
00:23:49,000 --> 00:23:50,566
to a current directory

513
00:23:50,933 --> 00:23:52,599
and then we can upload

514
00:23:53,266 --> 00:23:55,099
win pz dot EXE

515
00:23:56,133 --> 00:23:57,933
to upload this flower to the box

516
00:23:59,700 --> 00:24:03,733
and now we can run it so dot slash win PS dot EXE

517
00:24:04,900 --> 00:24:07,000
and let that run

518
00:24:07,000 --> 00:24:11,100
and while that runs I'm going to go check out Rico

519
00:24:12,100 --> 00:24:13,000
privasque

520
00:24:17,933 --> 00:24:18,799
so let's see

521
00:24:21,166 --> 00:24:22,499
components

522
00:24:25,166 --> 00:24:26,266
and printer setup

523
00:24:30,300 --> 00:24:31,466
so maybe we should run

524
00:24:32,100 --> 00:24:32,966
this command

525
00:24:37,766 --> 00:24:40,366
so it's abusing a create file

526
00:24:41,733 --> 00:24:43,533
and there's a proof of concept

527
00:24:55,333 --> 00:24:57,133
so we should probably try this

528
00:24:57,133 --> 00:24:58,066
let's see

529
00:25:00,533 --> 00:25:01,866
copy this

530
00:25:03,000 --> 00:25:04,200
and

531
00:25:05,300 --> 00:25:06,333
evil when

532
00:25:08,166 --> 00:25:09,166
RM

533
00:25:12,466 --> 00:25:13,899
let's get a 2nd shell to this

534
00:25:13,900 --> 00:25:15,933
so we can run that eye cackles command

535
00:25:21,566 --> 00:25:24,999
to see if the vulnerable driver is on this box

536
00:25:29,100 --> 00:25:30,733
that was not the command I want to run

537
00:25:31,966 --> 00:25:34,499
still not let's do control shift insert

538
00:25:34,500 --> 00:25:35,333
there we go

539
00:25:38,166 --> 00:25:39,466
can I find the path

540
00:25:39,966 --> 00:25:43,199
CD backslash program data

541
00:25:44,666 --> 00:25:45,499
dir

542
00:25:48,266 --> 00:25:49,466
I don't think it exists

543
00:25:50,566 --> 00:25:51,999
should have a Rico driver

544
00:25:52,900 --> 00:25:53,900
and we don't

545
00:26:02,166 --> 00:26:02,966
so

546
00:26:03,733 --> 00:26:06,866
don't know what that's doing there could just be a

547
00:26:08,066 --> 00:26:09,133
something the

548
00:26:09,533 --> 00:26:10,966
creator I think egotistical

549
00:26:10,966 --> 00:26:13,066
wanted to do and then decided not to

550
00:26:13,066 --> 00:26:14,999
so let's just move on

551
00:26:15,966 --> 00:26:17,099
and notes

552
00:26:18,733 --> 00:26:21,799
we can say the directory does not exist

553
00:26:23,866 --> 00:26:25,299
does not exist

554
00:26:26,333 --> 00:26:27,133
so

555
00:26:28,100 --> 00:26:29,766
let's go take a look

556
00:26:31,466 --> 00:26:33,333
and everything let's just go to the very top

557
00:26:38,300 --> 00:26:39,100
there we go

558
00:26:41,100 --> 00:26:44,366
see what it shows so we got power shell 2.0

559
00:26:44,866 --> 00:26:45,899
so we could probably evade

560
00:26:45,900 --> 00:26:47,066
any type of logging if there was

561
00:26:47,066 --> 00:26:48,266
by just going to that

562
00:26:49,400 --> 00:26:52,966
lapse is not installed w digest not enabled

563
00:26:57,766 --> 00:27:00,599
so for nothing is sticking out

564
00:27:02,900 --> 00:27:04,900
no a v USC

565
00:27:10,533 --> 00:27:13,466
and we have auto log on credentials

566
00:27:13,733 --> 00:27:14,366
with

567
00:27:14,366 --> 00:27:17,133
SVC loan manager in this password

568
00:27:18,300 --> 00:27:19,800
so let's go

569
00:27:20,300 --> 00:27:21,766
create creds

570
00:27:22,266 --> 00:27:24,066
SVC loan manager

571
00:27:26,500 --> 00:27:27,666
put this password

572
00:27:30,133 --> 00:27:32,466
and I'm just going to go quickly

573
00:27:32,466 --> 00:27:33,766
seeing if I see anything

574
00:27:33,766 --> 00:27:36,566
like an red highlight yellow

575
00:27:36,700 --> 00:27:37,500
font

576
00:27:37,733 --> 00:27:40,399
because that would mean definitely should look at that

577
00:27:41,100 --> 00:27:42,200
and we don't see anything

578
00:27:42,200 --> 00:27:44,566
so let's do net user

579
00:27:44,933 --> 00:27:47,533
svc underscore loan mgr

580
00:27:48,333 --> 00:27:49,366
slash domain

581
00:27:51,300 --> 00:27:53,600
and so tell us like what groups it's in

582
00:27:54,733 --> 00:27:55,999
and what it is

583
00:27:56,200 --> 00:27:58,333
so it's in remote management user

584
00:27:58,333 --> 00:28:00,333
and it's just a domain user

585
00:28:03,800 --> 00:28:07,166
we can try our account which is F smith

586
00:28:10,266 --> 00:28:13,399
same thing we can do net user domain

587
00:28:14,700 --> 00:28:17,266
and there is a H myth account

588
00:28:17,566 --> 00:28:20,266
so let's just look at what H myth is member of

589
00:28:22,100 --> 00:28:25,200
just the main users doesn't have that remote management

590
00:28:25,200 --> 00:28:26,666
so even we had his password

591
00:28:27,066 --> 00:28:28,299
can't really do anything

592
00:28:31,300 --> 00:28:33,000
this password expires

593
00:28:33,000 --> 00:28:34,766
all right it's already expired

594
00:28:36,400 --> 00:28:38,166
let's check loan manager

595
00:28:38,166 --> 00:28:39,399
how is that configured

596
00:28:41,400 --> 00:28:42,666
password expires never

597
00:28:44,933 --> 00:28:48,066
so let's go and run bloodhound

598
00:28:48,333 --> 00:28:50,099
and I don't think I've ran bloodhound

599
00:28:50,166 --> 00:28:51,533
since I switched to pair it

600
00:28:52,000 --> 00:28:53,866
so the reason why I'm going bloodhound

601
00:28:53,866 --> 00:28:57,333
is because it is active directory so

602
00:28:58,866 --> 00:28:59,666
yeah

603
00:29:00,666 --> 00:29:03,699
gonna install bloodhound 1st with pseudo app to install

604
00:29:04,700 --> 00:29:05,600
bloodhound

605
00:29:06,933 --> 00:29:09,366
yes and then we're going to get

606
00:29:10,700 --> 00:29:11,500
search

607
00:29:12,000 --> 00:29:14,166
Google get hub bloodhound

608
00:29:14,600 --> 00:29:17,066
to quickly go to the bloodhound page

609
00:29:17,533 --> 00:29:18,999
because this is the best place I found

610
00:29:19,000 --> 00:29:20,500
to download the ingestors

611
00:29:20,500 --> 00:29:22,600
if you don't want to compile it yourself

612
00:29:23,500 --> 00:29:25,900
so we can download show pound exe

613
00:29:29,300 --> 00:29:31,366
and doesn't look like wanted to download

614
00:29:31,466 --> 00:29:33,733
what if I can just copy the link

615
00:29:39,266 --> 00:29:40,199
w get

616
00:29:40,400 --> 00:29:41,200
that

617
00:29:45,266 --> 00:29:46,533
sweet downloaded

618
00:29:47,733 --> 00:29:49,699
file shirt pound

619
00:29:53,666 --> 00:29:54,466
come on

620
00:29:54,900 --> 00:29:56,333
time was lagging a little bit

621
00:29:59,500 --> 00:30:00,400
it is a

622
00:30:00,400 --> 00:30:01,366
executable

623
00:30:02,333 --> 00:30:03,933
so I can go back to a shell

624
00:30:04,333 --> 00:30:07,333
upload shut pound dot EXE

625
00:30:12,133 --> 00:30:15,399
and then while that runs we can launch bloodhound

626
00:30:16,500 --> 00:30:18,400
if I need to run this oh

627
00:30:18,700 --> 00:30:20,533
if I don't have to run this one with pseudo

628
00:30:21,533 --> 00:30:23,533
neo for J we're gonna have to start

629
00:30:23,733 --> 00:30:27,566
so pseudo neo for J console

630
00:30:32,100 --> 00:30:33,200
let this start

631
00:30:33,333 --> 00:30:36,599
and then we have to change the password in bolt

632
00:30:37,500 --> 00:30:38,900
so let's go here

633
00:30:43,533 --> 00:30:44,966
then use the name

634
00:30:44,966 --> 00:30:47,566
the default password is also near for J

635
00:30:48,133 --> 00:30:51,066
so let's just put the password of please sub

636
00:30:53,866 --> 00:30:56,499
and now when we go to bloodhound

637
00:30:57,766 --> 00:31:00,266
put the password please sub

638
00:31:02,533 --> 00:31:03,799
we should be able to log in

639
00:31:06,600 --> 00:31:07,400
there we go

640
00:31:08,366 --> 00:31:10,466
bloodhounds kind of picky sometimes when you type

641
00:31:10,533 --> 00:31:12,066
it doesn't try to reconnect

642
00:31:12,066 --> 00:31:14,333
and if it doesn't get a valid connection

643
00:31:14,733 --> 00:31:16,666
doesn't want you click that log on button

644
00:31:18,066 --> 00:31:20,533
if you ever forget the near for j password

645
00:31:20,933 --> 00:31:21,933
I believe

646
00:31:22,800 --> 00:31:24,666
you just delete the

647
00:31:25,766 --> 00:31:27,099
file in here let's see

648
00:31:28,100 --> 00:31:28,900
less

649
00:31:30,200 --> 00:31:31,000
comp

650
00:31:34,533 --> 00:31:35,366
data

651
00:31:36,500 --> 00:31:37,700
databases

652
00:31:39,000 --> 00:31:39,800
see

653
00:31:40,466 --> 00:31:43,366
reset near for J password

654
00:31:49,000 --> 00:31:50,000
near for J

655
00:31:50,000 --> 00:31:50,800
start

656
00:31:58,933 --> 00:32:00,199
I guess you can just follow those

657
00:32:01,600 --> 00:32:03,733
there was normally a file I normally just deleted

658
00:32:03,800 --> 00:32:06,000
and I can't find that file

659
00:32:09,466 --> 00:32:10,266
but

660
00:32:12,000 --> 00:32:13,066
password is please sub

661
00:32:13,066 --> 00:32:14,199
I'm sure the next video

662
00:32:14,200 --> 00:32:16,300
I'm going to have to find a way to

663
00:32:16,733 --> 00:32:19,733
reset the password because almost likely forget it

664
00:32:20,400 --> 00:32:25,066
so we upload a sharp pound we can execute sharp pound

665
00:32:27,666 --> 00:32:29,866
and this will create a zip

666
00:32:31,500 --> 00:32:32,300
and use the

667
00:32:32,366 --> 00:32:35,566
these collection methods group sessions trust ACL

668
00:32:38,166 --> 00:32:39,366
so let's do

669
00:32:40,500 --> 00:32:41,733
download

670
00:32:42,933 --> 00:32:44,099
this file

671
00:32:47,266 --> 00:32:50,366
then we need to go places home to open up

672
00:32:50,800 --> 00:32:51,600
a

673
00:32:52,466 --> 00:32:53,499
file browser

674
00:32:54,133 --> 00:32:55,399
go to sauna

675
00:32:57,600 --> 00:32:59,900
and then we can just drag and drop

676
00:33:00,766 --> 00:33:01,966
on a bloodhound

677
00:33:02,400 --> 00:33:03,366
and we can see

678
00:33:03,366 --> 00:33:04,866
it is now processing

679
00:33:08,266 --> 00:33:10,199
and the 1st thing I always like doing

680
00:33:10,800 --> 00:33:14,366
is marking my user that I have as owned

681
00:33:14,466 --> 00:33:16,466
so I just search for svc loan

682
00:33:17,066 --> 00:33:18,566
Mark user as owned

683
00:33:18,866 --> 00:33:21,466
and we want to Mark F smith

684
00:33:22,266 --> 00:33:23,766
as owned as well

685
00:33:28,000 --> 00:33:29,366
then we can do

686
00:33:33,366 --> 00:33:34,866
see click here

687
00:33:35,700 --> 00:33:39,900
queries shorteth past from owned principles

688
00:33:40,066 --> 00:33:41,533
and let's just check each one

689
00:33:42,866 --> 00:33:47,066
this is just showing we can PS remote to the DC

690
00:33:47,666 --> 00:33:48,899
not showing anything else

691
00:33:49,333 --> 00:33:52,599
so let's check the F smith principle

692
00:33:53,900 --> 00:33:55,066
same exact thing

693
00:33:55,800 --> 00:33:57,600
find all domain admins

694
00:33:58,166 --> 00:33:59,333
only administrator

695
00:34:01,000 --> 00:34:02,200
short as path

696
00:34:03,733 --> 00:34:07,866
let's see enterprise admins were not in that group

697
00:34:08,266 --> 00:34:09,899
administrator is not in that group

698
00:34:11,266 --> 00:34:11,966
and this user

699
00:34:11,966 --> 00:34:16,266
so nothing here helps principles with DC sync rights

700
00:34:16,666 --> 00:34:17,899
oh god let's

701
00:34:19,966 --> 00:34:23,966
weird graph but let's go over this administrator

702
00:34:25,166 --> 00:34:27,999
nothing this is the box itself

703
00:34:31,366 --> 00:34:33,566
we got this one SVC loan manager

704
00:34:37,066 --> 00:34:40,666
so we can click on the edge right click help

705
00:34:40,933 --> 00:34:41,899
and says the user

706
00:34:41,900 --> 00:34:43,700
SVC loan manager has the

707
00:34:43,733 --> 00:34:47,066
DS replication get changes all privilege on the domain

708
00:34:47,533 --> 00:34:49,766
individually the edge doesn't grant the ability to

709
00:34:50,066 --> 00:34:51,166
perform the attack

710
00:34:51,966 --> 00:34:54,533
however in conjunction with this right

711
00:34:54,766 --> 00:34:55,866
they can perform it

712
00:34:56,366 --> 00:34:57,899
and if you look at that 2nd one

713
00:34:57,900 --> 00:34:59,766
get changes that is

714
00:35:00,200 --> 00:35:02,066
most likely that right

715
00:35:03,933 --> 00:35:04,733
come on

716
00:35:04,733 --> 00:35:06,799
sometimes it's hard to click on the edges

717
00:35:07,166 --> 00:35:07,966
but

718
00:35:08,800 --> 00:35:10,100
abuse info

719
00:35:10,133 --> 00:35:12,199
if we want to run mimicaps on the box we could

720
00:35:12,500 --> 00:35:15,866
but impact it has a DC sync tool as well

721
00:35:16,133 --> 00:35:19,866
so we can just run that tool so let's go

722
00:35:21,266 --> 00:35:22,133
1st

723
00:35:23,733 --> 00:35:24,599
a new pain

724
00:35:28,000 --> 00:35:29,500
you don't need this pain anymore

725
00:35:30,366 --> 00:35:32,533
so we can do secrets dump dot pie

726
00:35:33,133 --> 00:35:38,733
egotistical bank dot local slash SVC

727
00:35:39,500 --> 00:35:40,800
learn mgr

728
00:35:41,866 --> 00:35:45,066
at 1010 175

729
00:35:47,500 --> 00:35:49,300
and let's copy the password

730
00:35:51,400 --> 00:35:52,200
so

731
00:35:52,466 --> 00:35:53,733
whoops we don't want that yet

732
00:35:55,333 --> 00:35:57,166
essentially how secrets dump works

733
00:35:57,166 --> 00:35:58,333
it's just secret dump

734
00:35:58,366 --> 00:36:01,333
and then a username and then at the target

735
00:36:01,533 --> 00:36:03,899
so egotessical dashbank dot local

736
00:36:03,900 --> 00:36:05,933
that's domain SBC loan manager

737
00:36:05,933 --> 00:36:06,933
that's the user

738
00:36:07,200 --> 00:36:10,600
at 10 1010 one 75 which is the domain controller

739
00:36:11,466 --> 00:36:12,766
paste the password in

740
00:36:14,400 --> 00:36:15,700
and we can see

741
00:36:16,133 --> 00:36:18,199
it doing a DC sync

742
00:36:18,200 --> 00:36:21,800
and essentially what this attack is is

743
00:36:22,333 --> 00:36:23,266
it's saying hey

744
00:36:23,300 --> 00:36:25,766
domain controller I'm another domain controller

745
00:36:26,100 --> 00:36:29,300
in order to join the domain we need to sync password

746
00:36:29,300 --> 00:36:30,966
so send me all the hashes and stuff

747
00:36:30,966 --> 00:36:33,499
so that's essentially what DC sync is

748
00:36:33,933 --> 00:36:37,099
and that lets us get the administrator hash

749
00:36:38,366 --> 00:36:40,166
and we can probably use this to do

750
00:36:40,166 --> 00:36:42,899
a pass the hash attack so we can do

751
00:36:45,300 --> 00:36:47,333
crack map exec dash U

752
00:36:47,900 --> 00:36:52,566
administrator dash P or I think dash capital H for hash

753
00:36:54,533 --> 00:36:55,966
so let's try this 1st

754
00:36:56,666 --> 00:36:58,766
10 1010 one 75

755
00:37:06,266 --> 00:37:07,166
and we can see

756
00:37:07,566 --> 00:37:09,799
it says pound whenever it says pound

757
00:37:10,066 --> 00:37:12,599
we should be able to do PS exact

758
00:37:12,966 --> 00:37:15,366
so let's do the same thing

759
00:37:15,700 --> 00:37:16,700
let's just go to a

760
00:37:17,500 --> 00:37:18,900
secret stump command

761
00:37:19,700 --> 00:37:22,766
erase that and do PS exec dot pi

762
00:37:23,666 --> 00:37:25,666
and change it to be

763
00:37:26,200 --> 00:37:27,466
administrator

764
00:37:31,166 --> 00:37:32,466
have got pie twice

765
00:37:34,066 --> 00:37:35,066
paste the hash

766
00:37:36,366 --> 00:37:38,366
oh I copied pound

767
00:37:39,933 --> 00:37:40,933
let's copy

768
00:37:41,800 --> 00:37:42,700
this

769
00:37:44,600 --> 00:37:46,100
L date that's my clipboard

770
00:37:48,133 --> 00:37:48,933
run it

771
00:37:51,933 --> 00:37:52,733
ah

772
00:37:53,700 --> 00:37:54,500
the exact

773
00:37:55,800 --> 00:37:57,566
pie H

774
00:37:59,666 --> 00:38:02,299
let's see is there a special thing for a hash

775
00:38:07,733 --> 00:38:08,866
dash ashes

776
00:38:17,700 --> 00:38:18,600
question shares

777
00:38:18,733 --> 00:38:22,266
so the format for dash hashes is

778
00:38:22,933 --> 00:38:23,733
let's see

779
00:38:25,200 --> 00:38:27,466
Len man hash NTLM hash

780
00:38:27,900 --> 00:38:28,700
and

781
00:38:29,266 --> 00:38:33,299
this is actually like that AAD3B thing

782
00:38:33,900 --> 00:38:35,466
that's let's see

783
00:38:36,666 --> 00:38:37,466
this

784
00:38:38,100 --> 00:38:39,933
which is the landman hash of nothing

785
00:38:39,933 --> 00:38:41,733
windows doesn't really use this anymore

786
00:38:42,000 --> 00:38:44,000
and it's not part of the authentication

787
00:38:44,000 --> 00:38:46,100
you can either authenticate with landman

788
00:38:46,400 --> 00:38:50,000
which is disable nowadays or NTLM

789
00:38:50,466 --> 00:38:52,699
and since the tool is asking for both

790
00:38:52,800 --> 00:38:54,500
since it's not going to use landman

791
00:38:54,500 --> 00:38:57,700
I just always have the habit of pacing the NTLM twice

792
00:38:58,766 --> 00:38:59,566
so

793
00:39:00,466 --> 00:39:03,799
with this we can now go to CD backslash

794
00:39:04,300 --> 00:39:07,266
users administrator

795
00:39:08,333 --> 00:39:09,399
if I can type

796
00:39:11,600 --> 00:39:12,500
test stop

797
00:39:13,600 --> 00:39:14,566
and

798
00:39:15,200 --> 00:39:18,300
get the root dot text so

799
00:39:18,666 --> 00:39:19,566
that'll be the box

800
00:39:19,566 --> 00:39:21,099
I hope you guys enjoyed it

801
00:39:21,366 --> 00:39:21,933
take care

802
00:39:21,933 --> 00:39:23,666
and I'll see you all next week

