1
00:00:00,366 --> 00:00:01,166
大家好，YouTube上

2
00:00:01,166 --> 00:00:03,199
的朋友们。我现在正在做Hack

3
00:00:03,200 --> 00:00:03,966
 the 

4
00:00:03,966 --> 00:00:06,299
Box的Sauna实验，这只是一个带有Web

5
00:00:06,300 --> 00:00:07,200
服务器和Active

6
00:00:07,300 --> 00:00:09,000
 Directory的Windows盒子，而且

7
00:00:09,000 --> 00:00:09,966
我们之前已经做过很多80

8
00:00:09,966 --> 00:00:12,399
端口的实验了。实验

9
00:00:12,500 --> 00:00:14,200
内容涉及到真正的Active Sizzle 

10
00:00:14,200 --> 00:00:15,500
和 Forest。与众不同

11
00:00:15,866 --> 00:00:19,899
的是，这次我们不能直接使用RPC客户端或

12
00:00:19,966 --> 00:00:20,899
LDAP来卸载盒子上

13
00:00:20,900 --> 00:00:23,566
的所有用户。相反，我们可以通过

14
00:00:23,566 --> 00:00:25,599
Kerberos预认证进行布尔逻辑来

15
00:00:25,933 --> 00:00:28,399
检查用户是否存在。如果你输入

16
00:00:28,700 --> 00:00:30,066
用户名，Kerberos响应“

17
00:00:30,100 --> 00:00:31,300
需要预先验证”，那么

18
00:00:31,300 --> 00:00:33,266
你就知道盒子上有该

19
00:00:33,366 --> 00:00:35,466
用户存在。所以我们要通过盒子的网站进行实验。

20
00:00:35,466 --> 00:00:37,733
从网站上获取一些用户名，然后

21
00:00:37,966 --> 00:00:39,133
使用一些魔法将这些名称转换

22
00:00:39,133 --> 00:00:41,799
为可能的用户名，将其传递到名为 curb 

23
00:00:41,866 --> 00:00:44,299
route 的工具中以查找一些有效的用户名

24
00:00:44,400 --> 00:00:46,200
，然后使用这些用户名将其

25
00:00:46,266 --> 00:00:47,533
传递给一些 impacket 脚本

26
00:00:47,533 --> 00:00:49,799
来执行一些 as 枚举攻击以获得一个

27
00:00:49,966 --> 00:00:52,066
帐户的密码哈希，

28
00:00:52,666 --> 00:00:54,966
将其传递到 hashcat 破解它，然后

29
00:00:54,966 --> 00:00:56,699
登录到该计算机。然后，

30
00:00:56,800 --> 00:00:58,600
一旦登录到该计算机，特权升级

31
00:00:58,900 --> 00:01:00,933
就只需要运行 BloodHound 

32
00:01:01,300 --> 00:01:02,900
和 Wind Peas 的

33
00:01:02,933 --> 00:01:05,866
组合输出，然后就可以进行 DC 同步

34
00:01:05,933 --> 00:01:08,333
。所以实际上它可能比听起来的要复杂得多，

35
00:01:08,400 --> 00:01:09,800
所以让我们开始吧

36
00:01:10,133 --> 00:01:11,266
。一如既往，我们要重新开始。

37
00:01:11,266 --> 00:01:13,333
nmap -sC -sV -oA

38
00:01:13,333 --> 00:01:15,966
 <directory> sauna 1010.175我们需要先

39
00:01:15,966 --> 00:01:18,933
创建nmap文件夹然后我们可以使用选择的端口来

40
00:01:20,700 --> 00:01:22,100
运行nmap并在命令中

41
00:01:22,100 --> 00:01:24,066
添加伪造标识-pseudo和-

42
00:01:24,300 --> 00:01:26,300
v标志

43
00:01:27,266 --> 00:01:29,299
使用它，我们能看到nmap正在检测

44
00:01:29,300 --> 00:01:30,933
到服务器上开放的端口我们可以看到

45
00:01:30,933 --> 00:01:33,166
80端口是开放的，指示网站正在

46
00:01:33,400 --> 00:01:36,500
运行53端口属于DNS，还有一些SMB和RPC

47
00:01:36,500 --> 00:01:43,100
端口我不确定3268端口是做什么

48
00:01:43,300 --> 00:01:46,000
的593端口是什么我也

49
00:01:46,766 --> 00:01:49,099
不确定0636端口是加密 L 

50
00:01:49,100 --> 00:01:51,600
DAP端口我们还可以看到Kerberos

51
00:01:52,333 --> 00:01:54,099
在这里基于这些信息，

52
00:01:54,100 --> 00:01:57,933
我们可以确定445是SMB端口

53
00:01:58,300 --> 00:02:00,133
我们知道这是一个Windows系统53端口

54
00:02:00,366 --> 00:02:03,733
是DNS服务，88端口

55
00:02:03,766 --> 00:02:07,133
是Kerberos认证服务我猜这是一个Windows域控制器那么

56
00:02:07,133 --> 00:02:09,133
我想先做的一件事情就是枚举一下

57
00:02:09,133 --> 00:02:10,733
445端口然后再看80

58
00:02:10,733 --> 00:02:13,099
端口有什么那么我们可以执行命令crackmapexec

59
00:02:13,600 --> 00:02:14,866
 SMB 

60
00:02:15,800 --> 00:02:19,733
1010.175来探测关于此主机

61
00:02:19,866 --> 00:02:21,766
的一切信息

62
00:02:22,066 --> 00:02:23,133
首先我们看到主机名为sana

63
00:02:23,866 --> 00:02:26,866
，域名为egotistical-dashbank.local，并且

64
00:02:26,866 --> 00:02:29,766
签名设置为true，同时SMBv1已禁用接下来我们可以

65
00:02:31,000 --> 00:02:34,866
尝试执行共享目录命令，看看能否枚举出

66
00:02:35,200 --> 00:02:35,966
一些

67
00:02:35,966 --> 00:02:39,466
共享资源然后我们得到了状态，使用方式是“use 

68
00:02:40,900 --> 00:02:43,866
a chess”，可以删除。

69
00:02:43,866 --> 00:02:46,299
我们可以尝试使用空的用户名和密码，

70
00:02:46,600 --> 00:02:48,400
看看是否可以绕开验证。有时可以

71
00:02:48,766 --> 00:02:50,666
，有时不行。如果我们看到访问被拒绝

72
00:02:50,866 --> 00:02:54,499
，那么就无法进行下一步操作。可以

73
00:02:55,266 --> 00:02:57,966
尝试使用SMB map等其他工具。我

74
00:02:58,000 --> 00:03:02,666
认为命令类似于SMBMap -i 10.10.1.75 -U

75
00:03:03,533 --> 00:03:04,333


76
00:03:05,600 --> 00:03:06,400
 -

77
00:03:08,900 --> 00:03:09,300
P

78
00:03:09,300 --> 00:03:11,966
 -H。我们运行这个命令后什么

79
00:03:12,266 --> 00:03:13,066


80
00:03:13,600 --> 00:03:15,600
也没得到。所以最好再尝试使用其他的SMB工具。 
